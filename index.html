<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מיקום, מהירויות, כיוון, Pitch ו-Roll ללא GPS</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }

        .compass-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 20px auto;
        }

        .compass {
            width: 100%;
            height: 100%;
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/Compass.svg/1024px-Compass.svg.png');
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            transition: transform 0.5s ease-out;
        }

    </style>
</head>
<body>
    <h1>מערכת ניווט ללא GPS</h1>

    <!-- טופס הזנת מיקום התחלתי -->
    <form id="startLocationForm">
        <label for="startX">הכנס קואורדינטת X התחלתית:</label>
        <input type="number" id="startX" step="0.01" value="0"><br><br>
        <label for="startY">הכנס קואורדינטת Y התחלתית:</label>
        <input type="number" id="startY" step="0.01" value="0"><br><br>
        <button type="button" onclick="setStartLocation()">עדכן מיקום התחלתי</button>
    </form>

    <p>מיקום נוכחי:</p>
    <p>X: <span id="x">0</span> | Y: <span id="y">0</span></p>
    
    <p>מהירות נוכחית:</p>
    <p>מהירות בציר X: <span id="velocityX">0</span> m/s | מהירות בציר Y: <span id="velocityY">0</span> m/s</p>
    
    <p>כיוון: <span id="azimuth">0</span>°</p>
    
    <p>Pitch: <span id="pitch">0</span>° | Roll: <span id="roll">0</span>°</p>

    <!-- מצפן שמסתובב בהתאם לאזימוט -->
    <div class="compass-container">
        <div id="compass" class="compass"></div>
    </div>

    <script>
        // משתנים למיקום ומהירות נוכחיים
        let currentX = 0;
        let currentY = 0;
        let velocityX = 0;
        let velocityY = 0;
        let azimuth = 0;
        let pitch = 0;
        let roll = 0;

        // זמן בין מדידות (שניות)
        const dt = 0.05;
        const THRESHOLD = 0.02; // סף להבדלים קטנים בתאוצה למניעת רעש

        // פונקציה לעדכון המיקום ההתחלתי מהטופס
        function setStartLocation() {
            const startX = parseFloat(document.getElementById('startX').value);
            const startY = parseFloat(document.getElementById('startY').value);
            currentX = startX;
            currentY = startY;

            // עדכון המיקום ההתחלתי על המסך
            document.getElementById('x').innerText = currentX.toFixed(2);
            document.getElementById('y').innerText = currentY.toFixed(2);
        }

        // מאזין לאירועי תנועה לחישוב מהירות, מיקום, Pitch ו-Roll
        window.addEventListener('devicemotion', (event) => {
            // נתוני תאוצה כולל כבידה
            const accX = event.accelerationIncludingGravity.x;
            const accY = event.accelerationIncludingGravity.y;
            const accZ = event.accelerationIncludingGravity.z;

            // חישוב Pitch ו-Roll
            pitch = Math.atan2(accX, Math.sqrt(accY * accY + accZ * accZ)) * 180 / Math.PI;
            roll = Math.atan2(accY, accZ) * 180 / Math.PI;

            document.getElementById('pitch').innerText = pitch.toFixed(2);
            document.getElementById('roll').innerText = roll.toFixed(2);

            // חישוב מהירות בצירי X ו-Y (אינטגרציה של התאוצה)
            if (Math.abs(accX) > THRESHOLD) velocityX += accX * dt;
            if (Math.abs(accY) > THRESHOLD) velocityY += accY * dt;

            // חישוב המרחק שעבר המכשיר בכל ציר (אינטגרציה של המהירות)
            const distanceX = velocityX * dt;
            const distanceY = velocityY * dt;

            // עדכון המיקום לפי המרחק שעבר והכיוון (אזימוט)
            currentX += distanceX * Math.cos(azimuth * Math.PI / 180);
            currentY += distanceY * Math.sin(azimuth * Math.PI / 180);

            // עדכון המידע על המסך
            document.getElementById('x').innerText = currentX.toFixed(2);
            document.getElementById('y').innerText = currentY.toFixed(2);
            document.getElementById('velocityX').innerText = velocityX.toFixed(2);
            document.getElementById('velocityY').innerText = velocityY.toFixed(2);
        });

        // מאזין לאירועי מגנטומטר לחישוב כיוון (אזימוט)
        window.addEventListener('deviceorientation', (event) => {
            azimuth = event.alpha;  // הכיוון המגנטי (אזימוט)

            // עדכון המידע על המסך
            document.getElementById('azimuth').innerText = azimuth.toFixed(2);

            // סיבוב המצפן בהתאם לאזימוט
            const compassElement = document.getElementById('compass');
            compassElement.style.transform = `rotate(${-azimuth}deg)`;
        });
    </script>
</body>
</html>