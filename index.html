<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>חישוב זוויות Pitch ו-Roll בתנאי תאוצה קיצוניים</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
    </style>
</head>
<body>
    <h1>חישוב זוויות Pitch ו-Roll בתנאי תאוצה קיצוניים</h1>
    <p>Pitch: <span id="pitch">0</span>°</p>
    <p>Roll: <span id="roll">0</span>°</p>

    <script>
        // משתנים לאחסון זוויות הפילטר
        let pitch = 0, roll = 0;
        const alpha = 0.98;  // קבוע הפילטר המשולב
        const dt = 0.05;     // זמן בין מדידות (בשניות)

        // רמות סף לזיהוי תאוצה קיצונית
        const ACC_THRESHOLD = 1.5;  // סף לגילוי תאוצה גבוהה

        // מאזין לאירועי תנועה מהמכשיר
        window.addEventListener('devicemotion', (event) => {
            // נתוני תאוצה כולל כבידה
            const accX = event.accelerationIncludingGravity.x;
            const accY = event.accelerationIncludingGravity.y;
            const accZ = event.accelerationIncludingGravity.z;

            // נתוני ג'ירוסקופ - מהירות זוויתית
            const gyroX = event.rotationRate.alpha; // מהירות זוויתית בציר X
            const gyroY = event.rotationRate.beta;  // מהירות זוויתית בציר Y

            // חישוב גודל התאוצה הכוללת
            const accTotal = Math.sqrt(accX * accX + accY * accY + accZ * accZ);

            // אם התאוצה גבוהה מסף מסוים, נסתמך יותר על הג'ירוסקופ
            if (accTotal > ACC_THRESHOLD) {
                // במצב של תאוצה גבוהה, נסתמך בעיקר על הג'ירוסקופ
                pitch = pitch + gyroY * dt;
                roll = roll + gyroX * dt;
            } else {
                // כאשר התאוצה יציבה, נשתמש בפילטר המשולב
                const pitchAcc = Math.atan2(accX, Math.sqrt(accY * accY + accZ * accZ)) * 180 / Math.PI;
                const rollAcc = Math.atan2(accY, accZ) * 180 / Math.PI;

                // פילטר משולב - שילוב בין הג'ירוסקופ והמד תאוצה
                pitch = alpha * (pitch + gyroY * dt) + (1 - alpha) * pitchAcc;
                roll = alpha * (roll + gyroX * dt) + (1 - alpha) * rollAcc;
            }

            // הצגת הערכים המעודכנים
            document.getElementById('pitch').innerText = pitch.toFixed(2);
            document.getElementById('roll').innerText = roll.toFixed(2);
        });
    </script>
</body>
</html>